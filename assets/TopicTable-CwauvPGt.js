import{f as p,a as g,u as v,j as e,A}from"./index-BPKX_cgv.js";import{i as h}from"./DeleteAlert-CxMyO-el.js";import{A as w,C as S,M as U}from"./CommonDialog-B8uZeMNL.js";import{a as D,u as j}from"./useMutation-DH1_dSWY.js";import{u as f}from"./useUserToken-GJF2sMhJ.js";const x="https://vgok.onrender.com/api",E=async(t,r)=>p(`${x}/posts/create`,"POST",r,t),$=async(t,r,a)=>p(`${x}/posts/update/${t}`,"PUT",a,r),k=async(t,r)=>p(`${x}/posts/delete/${t}`,"DELETE",r),q=async(t,r)=>{let a=`${x}/posts/all`;return r&&(a+=`?status=${r}`),p(a,"GET",t)},z=(t,r=10,a=0)=>{const n=f();return D({queryKey:["topics",t,r,a],queryFn:()=>q(n||"",t),enabled:!!n,staleTime:1e3*60*5})},L=()=>{const t=f(),r=g(),a=j({mutationFn:d=>E(d,t||""),onSuccess:()=>r.invalidateQueries({queryKey:["topics"]})}),n=j({mutationFn:({id:d,data:c})=>$(d,c,t||""),onSuccess:()=>r.invalidateQueries({queryKey:["topics"]})}),o=j({mutationFn:d=>k(d,t||""),onSuccess:()=>r.invalidateQueries({queryKey:["topics"]})});return{createTopic:a.mutateAsync,updateTopic:n.mutateAsync,deleteTopic:o.mutateAsync,isCreating:a.isPending,isUpdating:n.isPending,isDeleting:o.isPending}},C=({data:t,loading:r,onRefresh:a,page:n=1,pageSize:o=10,totalCount:d=0,onPageChange:c})=>{var b;const{user:i}=v(),l=(i==null?void 0:i.role)||((b=i==null?void 0:i.user_metadata)==null?void 0:b.role),{createTopic:N,updateTopic:u}=L(),m=Math.ceil(d/o);return e.jsxs("div",{className:"overflow-x-auto bg-white rounded-xl shadow",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-blue-950 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3",children:"TITLE"}),e.jsx("th",{className:"text-left px-6 py-3",children:"FORUM"}),e.jsx("th",{className:"text-left px-6 py-3",children:"UP - DOWN VOTE"}),e.jsx("th",{className:"text-left px-6 py-3",children:"STATUS"}),e.jsx("th",{className:"text-left px-6 py-3",children:"ACTION"})]})}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-6 text-gray-500",children:"Loading topics..."})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-6 text-gray-500",children:"No topics found."})}):t.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-4",children:s.title}),e.jsx("td",{className:"px-6 py-4",children:s.content}),e.jsxs("td",{className:"px-6 py-4 flex items-center gap-2",children:[e.jsxs("span",{className:"text-green-500 flex items-center gap-1",children:[e.jsx(A,{size:12})," ",s.upvotes||0]}),e.jsxs("span",{className:"text-red-500 flex items-center gap-1",children:[e.jsx(w,{size:12})," ",s.downvotes||0]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="approved"?"bg-green-100 text-green-600":s.status==="rejected"?"bg-red-100 text-red-600":"bg-orange-100 text-orange-600"}`,children:s.status||"Pending"})}),e.jsxs("td",{className:"px-6 py-4 flex flex-wrap gap-2",children:[e.jsx(S,{formData:s,onCreateOrUpdate:a,type:"view",trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-blue-500 text-blue-500 px-3 py-1 rounded hover:bg-blue-50 text-sm",children:[e.jsx(U,{size:16})," Detail"]}),onCreate:y=>N(y).then(a),onUpdate:(y,T)=>u({id:y,data:T}).then(a)}),(l==="admin"||l==="superadmin")&&e.jsx(h,{title:"Approve Topic?",content:"Are you sure you want to approve this topic?",confirmLabel:"Approve",onConfirm:()=>u({id:s.id,data:{...s,status:"approved"}}),onSuccess:a,trigger:e.jsx("button",{className:"flex items-center gap-2 border border-green-600 text-green-600 px-3 py-1 rounded hover:bg-green-50 text-sm disabled:opacity-50",disabled:s.status==="approved",title:s.status==="approved"?"Already approved":"",children:"Approve"})}),(l==="admin"||l==="superadmin")&&e.jsx(h,{title:"Reject Topic?",content:"Are you sure you want to reject this topic?",confirmLabel:"Reject",onConfirm:()=>u({id:s.id,data:{...s,status:"rejected"}}),onSuccess:a,trigger:e.jsx("button",{className:"flex items-center gap-2 border border-red-600 text-red-600 px-3 py-1 rounded hover:bg-red-50 text-sm disabled:opacity-50",disabled:s.status==="rejected",title:s.status==="rejected"?"Already rejected":"",children:"Reject"})})]})]},s.id))})]}),m>1&&e.jsxs("div",{className:"flex justify-end items-center gap-2 p-4",children:[e.jsx("button",{className:"text-sm px-3 py-1 border rounded disabled:opacity-50",onClick:()=>c==null?void 0:c(n-1),disabled:n<=1,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",n," of ",m]}),e.jsx("button",{className:"text-sm px-3 py-1 border rounded disabled:opacity-50",onClick:()=>c==null?void 0:c(n+1),disabled:n>=m,children:"Next"})]})]})};export{C as T,z as u};
