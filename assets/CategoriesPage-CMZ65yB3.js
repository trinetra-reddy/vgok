import{f as w,r as g,u as k,j as e,t as N,a as O}from"./index-BPKX_cgv.js";import{B as q,P as R,a as U}from"./button-DZgg7u2Y.js";import{u as z,D as B,a as M,b as V,c as Q,d as H,e as K,f as G,i as W}from"./DeleteAlert-CxMyO-el.js";import{u as J,L as S,I as X,a as Y,f as Z}from"./index-B_O3rHGe.js";import{u as P}from"./useUserToken-GJF2sMhJ.js";import{a as ee,u as se}from"./useMutation-DH1_dSWY.js";import{P as te,T as re}from"./trash-2-DWMekC5r.js";const C="https://vgok.onrender.com/api",ie=async(t,s)=>w(`${C}/categories/create`,"POST",s,t),ae=async(t,s,n)=>w(`${C}/categories/update/${t}`,"PUT",n,s),le=async(t,s)=>w(`${C}/categories/delete/${t}`,"DELETE",s),ne=async(t,s=10,n=0)=>{const m=`${C}/categories?limit=${s}&offset=${n}`;return w(m,"GET",t)},D=({onCreateOrUpdate:t,category:s,trigger:n,viewOnly:m})=>{const[l,c]=g.useState(!1),[d,j]=g.useState(!1),{user:p}=k(),r=P(),i=!!s,a=m,{register:o,handleSubmit:b,reset:x,setValue:u,formState:{errors:h}}=z(),{forums:T,isLoading:E}=J({token:r,limit:100});g.useEffect(()=>{l&&s?(u("title",s.title),u("description",s.description),s.forum_id&&u("forum_id",s.forum_id)):x()},[l,s,x,u]);const _=async f=>{const{title:A,description:$,forum_id:L}=f,y=T.find(v=>v.id===L),I=(y==null?void 0:y.title)||"",F={title:A,description:$,forumId:L,forum_name:I};try{p&&(j(!0),i&&(s!=null&&s.id)?(await ae(s.id,F,p.token),N.success("Category updated successfully.")):(await ie(F,p.token),N.success("Category created successfully.")),t==null||t(),x(),c(!1))}catch(v){N.error("Something went wrong."),console.error(v)}finally{j(!1)}};return e.jsxs(B,{open:l,onOpenChange:c,children:[e.jsx(M,{asChild:!0,children:n??e.jsxs(q,{variant:"outline",className:"flex items-center gap-2 border border-[#4269c2] text-[#4269c2] hover:bg-blue-950 hover:text-white min-h-[42px] cursor-pointer",children:[e.jsx(R,{size:16})," Create New"]})}),e.jsxs(V,{className:"sm:max-w-2xl w-full",children:[e.jsxs(Q,{children:[e.jsx(H,{className:"text-lg font-bold text-blue-950",children:a?"View Category":i?"Update Category":"Create Category"}),e.jsx(K,{className:"text-sm text-gray-500",children:i?"Edit the details and click update.":"Fill in the details to add a new category."})]}),e.jsxs("form",{onSubmit:b(_),className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsxs(S,{htmlFor:"forum",children:["Select Forum ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"forum",...o("forum_id",{required:!0}),className:"mt-1 h-10 border border-gray-300 rounded px-3 text-sm w-full",defaultValue:"",disabled:E||a,children:E?e.jsx("option",{children:"Loading forums..."}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",disabled:!0,children:"-- Select a forum --"}),T.map(f=>e.jsx("option",{value:f.id,children:f.title},f.id))]})}),h.forum_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Forum selection is required."})]}),e.jsxs("div",{children:[e.jsxs(S,{htmlFor:"title",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(X,{disabled:a,id:"title",...o("title",{required:!0}),className:"mt-1 h-10 border border-gray-300 rounded px-3 text-sm"}),!a&&h.title&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Title is required."})]}),e.jsxs("div",{children:[e.jsxs(S,{htmlFor:"description",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description",disabled:a,...o("description",{required:!0}),className:"mt-1 min-h-[100px] border border-gray-300 rounded px-3 py-2 text-sm w-full resize-none focus:ring-2 focus:ring-blue-500"}),!a&&h.description&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Description is required."})]}),!a&&e.jsx(G,{className:"mt-4",children:e.jsx(q,{type:"submit",className:"w-full bg-blue-950 hover:bg-blue-900 text-white font-semibold text-sm h-11 rounded flex items-center justify-center",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),i?"Updating...":"Submitting..."]}):i?"Update":"Submit"})})]})]})]})},oe=({token:t,limit:s=100,offset:n=0})=>{const m=O(),l=ee({queryKey:["categories",s,n],queryFn:()=>ne(t||"",s,n).then(d=>d.data||[]),enabled:!!t,staleTime:1e3*60*5}),c=se({mutationFn:d=>{if(!t)throw new Error("Token missing");return le(d,t)},onSuccess:()=>{m.invalidateQueries({queryKey:["categories"]})}});return{categories:l.data||[],isLoading:l.isLoading,isDeleting:c.isPending,deleteCategory:c.mutateAsync,refetchCategories:l.refetch}},fe=()=>{const t=P(),{categories:s,isLoading:n,deleteCategory:m,refetchCategories:l}=oe({token:t,limit:100}),[c,d]=g.useState(s);g.useEffect(()=>{d(s)},[s]);const j=r=>{const i=r.toLowerCase(),a=s.filter(o=>{var b,x,u,h;return((x=(b=o==null?void 0:o.title)==null?void 0:b.toLowerCase())==null?void 0:x.includes(i))||((h=(u=o==null?void 0:o.description)==null?void 0:u.toLowerCase())==null?void 0:h.includes(i))});d(a)},p=async(r,i)=>{await m(r),N.success(`"${i}" has been removed.`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(U,{title:"All Categories",searchPlaceholder:"Search by Category",onSearch:j,createButton:e.jsx(D,{onCreateOrUpdate:l})}),e.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm table-auto",children:[e.jsx("thead",{className:"bg-blue-950 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3 w-1/4",children:"TITLE"}),e.jsx("th",{className:"text-left px-6 py-3 w-1/4",children:"FORUM"}),e.jsx("th",{className:"text-left px-6 py-3 w-auto",children:"DESCRIPTION"}),e.jsx("th",{className:"text-left px-4 py-3",children:"DATE"}),e.jsx("th",{className:"text-left px-6 py-3 whitespace-nowrap w-1/4",children:"ACTION"})]})}),e.jsx("tbody",{children:c.length>0?c.map((r,i)=>{var a;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-4 align-top",children:r.title}),e.jsx("td",{className:"px-6 py-4 align-top",children:r.forum_name}),e.jsxs("td",{className:"px-4 py-3 align-top max-w-[300px]",children:[e.jsx("div",{className:"line-clamp-2 text-sm max-w-full",children:(r.description??"").length>120?((a=r.description)==null?void 0:a.slice(0,120))+"...":r.description||"-"}),(r.description??"").length>120&&e.jsx(D,{category:r,viewOnly:!0,trigger:e.jsx("button",{className:"text-xs text-blue-600 hover:underline mt-1 inline-block",children:"Read more"})})]}),e.jsx("td",{className:"px-4 py-3 align-top",children:Z(r.updated_at||r.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(D,{category:r,onCreateOrUpdate:l,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-green-500 text-green-500 px-3 py-1 rounded hover:bg-green-50 text-sm",children:[e.jsx(te,{size:16})," Edit"]})}),e.jsx(W,{title:"Delete Category?",content:"This category will be permanently removed.",confirmLabel:"Remove",onConfirm:()=>p(r.id,r.title),onSuccess:l,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-red-500 text-red-500 px-3 py-1 rounded hover:bg-red-50 text-sm",children:[e.jsx(re,{size:16})," Delete"]})})]})})]},i)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-gray-500 px-6 py-6",children:n?"Loading...":"No categories found."})})})]})})]})};export{fe as default};
