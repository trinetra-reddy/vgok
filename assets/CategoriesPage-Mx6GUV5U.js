import{a as O,r as f,u as z,j as e,t as N}from"./index-BFFADSzA.js";import{a as R,B as q,P as V,b as B}from"./button-Bk2Magj1.js";import{g as _,u as Q,D as U,a as H,b as K,c as M,d as $,e as G,f as J,P as W,h as X,T as Y}from"./useUserToken-XQpUb8zr.js";import{g as Z,L as y,I as ee,a as se,f as te}from"./index-D0K7OGu7.js";import{u as re,c as ie,a as ae}from"./useCategories-Dx5EoVpB.js";const le=(n,t=100,m=0)=>{const j=O(),{data:a=[],isLoading:d,error:o,refetch:u,isFetched:c}=R({queryKey:["forums",t,m],queryFn:()=>Z(n||"",t,m).then(s=>s.data||[]),enabled:!1,staleTime:1e3*60*5});return{forums:a,isLoading:d,error:o,refetch:u,isFetched:c,invalidate:()=>j.invalidateQueries({queryKey:["forums"]})}},v=({onCreateOrUpdate:n,category:t,trigger:m,viewOnly:j})=>{const[a,d]=f.useState(!1),[o,u]=f.useState(!1),{user:c}=z(),s=_(),r=!!t,i=j,{register:l,handleSubmit:g,reset:h,setValue:x,formState:{errors:p}}=Q(),{forums:S,isLoading:D,refetch:F,isFetched:L}=le(s);f.useEffect(()=>{a&&!L&&s&&F()},[a,s,L,F]),f.useEffect(()=>{a&&t?(x("title",t.title),x("description",t.description),t.forum_id&&x("forum_id",t.forum_id)):h()},[a,t,h,x]);const k=async b=>{const{title:I,description:P,forum_id:T}=b,w=S.find(C=>C.id===T),A=(w==null?void 0:w.title)||"",E={title:I,description:P,forumId:T,forum_name:A};try{c&&(u(!0),r&&(t!=null&&t.id)?(await re(t.id,E,c.token),N.success("Category updated successfully.")):(await ie(E,c.token),N.success("Category created successfully.")),n==null||n(),h(),d(!1))}catch(C){N.error("Something went wrong."),console.error(C)}finally{u(!1)}};return e.jsxs(U,{open:a,onOpenChange:d,children:[e.jsx(H,{asChild:!0,children:m??e.jsxs(q,{variant:"outline",className:"flex items-center gap-2 border border-[#4269c2] text-[#4269c2] hover:bg-blue-950 hover:text-white min-h-[42px] cursor-pointer",children:[e.jsx(V,{size:16})," Create New"]})}),e.jsxs(K,{className:"sm:max-w-2xl w-full",children:[e.jsxs(M,{children:[e.jsx($,{className:"text-lg font-bold text-blue-950",children:i?"View Category":r?"Update Category":"Create Category"}),e.jsx(G,{className:"text-sm text-gray-500",children:r?"Edit the details and click update.":"Fill in the details to add a new category."})]}),e.jsxs("form",{onSubmit:g(k),className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsxs(y,{htmlFor:"forum",children:["Select Forum ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"forum",...l("forum_id",{required:!0}),className:"mt-1 h-10 border border-gray-300 rounded px-3 text-sm w-full",defaultValue:"",disabled:D||i,children:D?e.jsx("option",{children:"Loading forums..."}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",disabled:!0,children:"-- Select a forum --"}),S.map(b=>e.jsx("option",{value:b.id,children:b.title},b.id))]})}),p.forum_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Forum selection is required."})]}),e.jsxs("div",{children:[e.jsxs(y,{htmlFor:"title",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ee,{disabled:i,id:"title",...l("title",{required:!0}),className:"mt-1 h-10 border border-gray-300 rounded px-3 text-sm"}),!i&&p.title&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Title is required."})]}),e.jsxs("div",{children:[e.jsxs(y,{htmlFor:"description",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description",disabled:i,...l("description",{required:!0}),className:"mt-1 min-h-[100px] border border-gray-300 rounded px-3 py-2 text-sm w-full resize-none focus:ring-2 focus:ring-blue-500"}),!i&&p.description&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Description is required."})]}),!i&&e.jsx(J,{className:"mt-4",children:e.jsx(q,{type:"submit",className:"w-full bg-blue-950 hover:bg-blue-900 text-white font-semibold text-sm h-11 rounded flex items-center justify-center",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}),r?"Updating...":"Submitting..."]}):r?"Update":"Submit"})})]})]})]})},me=()=>{const n=_(),{categories:t,isLoading:m,deleteCategory:j,refetchCategories:a}=ae({token:n,limit:100}),[d,o]=f.useState(t);f.useEffect(()=>{o(t)},[t]);const u=s=>{const r=s.toLowerCase(),i=t.filter(l=>{var g,h,x,p;return((h=(g=l==null?void 0:l.title)==null?void 0:g.toLowerCase())==null?void 0:h.includes(r))||((p=(x=l==null?void 0:l.description)==null?void 0:x.toLowerCase())==null?void 0:p.includes(r))});o(i)},c=async(s,r)=>{await j(s),N.success(`"${r}" has been removed.`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(B,{title:"All Categories",searchPlaceholder:"Search by Category",onSearch:u,createButton:e.jsx(v,{onCreateOrUpdate:a})}),e.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm table-auto",children:[e.jsx("thead",{className:"bg-blue-950 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3 w-1/4",children:"TITLE"}),e.jsx("th",{className:"text-left px-6 py-3 w-1/4",children:"FORUM"}),e.jsx("th",{className:"text-left px-6 py-3 w-auto",children:"DESCRIPTION"}),e.jsx("th",{className:"text-left px-4 py-3",children:"DATE"}),e.jsx("th",{className:"text-left px-6 py-3 whitespace-nowrap w-1/4",children:"ACTION"})]})}),e.jsx("tbody",{children:d.length>0?d.map((s,r)=>{var i;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-4 align-top",children:s.title}),e.jsx("td",{className:"px-6 py-4 align-top",children:s.forum_name}),e.jsxs("td",{className:"px-4 py-3 align-top max-w-[300px]",children:[e.jsx("div",{className:"line-clamp-2 text-sm max-w-full",children:(s.description??"").length>120?((i=s.description)==null?void 0:i.slice(0,120))+"...":s.description||"-"}),(s.description??"").length>120&&e.jsx(v,{category:s,viewOnly:!0,trigger:e.jsx("button",{className:"text-xs text-blue-600 hover:underline mt-1 inline-block",children:"Read more"})})]}),e.jsx("td",{className:"px-4 py-3 align-top",children:te(s.updated_at||s.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(v,{category:s,onCreateOrUpdate:a,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-green-500 text-green-500 px-3 py-1 rounded hover:bg-green-50 text-sm",children:[e.jsx(W,{size:16})," Edit"]})}),e.jsx(X,{title:"Delete Category?",content:"This category will be permanently removed.",confirmLabel:"Remove",onConfirm:()=>c(s.id,s.title),onSuccess:a,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-red-500 text-red-500 px-3 py-1 rounded hover:bg-red-50 text-sm",children:[e.jsx(Y,{size:16})," Delete"]})})]})})]},r)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-gray-500 px-6 py-6",children:m?"Loading...":"No categories found."})})})]})})]})};export{me as default};
