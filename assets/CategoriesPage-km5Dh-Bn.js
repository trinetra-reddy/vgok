import{f as w,r as g,u as I,j as e,t as N,a as O}from"./index-C-LhTu0I.js";import{u as R,D as U,a as z,B as q,P as B,b as M,c as V,d as Q,e as H,f as K,i as G,j as W,k as J,T as X}from"./DeleteAlert-UoRJvI9x.js";import{b as _,c as Y,L as S,I as Z,a as ee,d as se,u as te,f as ie}from"./index-CRbS4HWL.js";const C="https://vgok.onrender.com/api",re=async(t,s)=>w(`${C}/categories/create`,"POST",s,t),ae=async(t,s,n)=>w(`${C}/categories/update/${t}`,"PUT",n,s),le=async(t,s)=>w(`${C}/categories/delete/${t}`,"DELETE",s),ne=async(t,s=10,n=0)=>{const u=`${C}/categories?limit=${s}&offset=${n}`;return w(u,"GET",t)},D=({onCreateOrUpdate:t,category:s,trigger:n,viewOnly:u})=>{const[l,c]=g.useState(!1),[o,j]=g.useState(!1),{user:p}=I(),i=_(),r=!!s,a=u,{register:d,handleSubmit:b,reset:m,setValue:x,formState:{errors:h}}=R(),{forums:T,isLoading:E}=Y({token:i,limit:100});g.useEffect(()=>{l&&s?(x("title",s.title),x("description",s.description),s.forum_id&&x("forum_id",s.forum_id)):m()},[l,s,m,x]);const P=async f=>{const{title:A,description:$,forum_id:L}=f,y=T.find(v=>v.id===L),k=(y==null?void 0:y.title)||"",F={title:A,description:$,forumId:L,forum_name:k};try{p&&(j(!0),r&&(s!=null&&s.id)?(await ae(s.id,F,p.token),N.success("Category updated successfully.")):(await re(F,p.token),N.success("Category created successfully.")),t==null||t(),m(),c(!1))}catch(v){N.error("Something went wrong."),console.error(v)}finally{j(!1)}};return e.jsxs(U,{open:l,onOpenChange:c,children:[e.jsx(z,{asChild:!0,children:n??e.jsxs(q,{variant:"outline",className:"flex items-center gap-2 border border-[#4269c2] text-[#4269c2] hover:bg-blue-950 hover:text-white min-h-[42px] cursor-pointer",children:[e.jsx(B,{size:16})," Create New"]})}),e.jsxs(M,{className:"sm:max-w-2xl w-full",children:[e.jsxs(V,{children:[e.jsx(Q,{className:"text-lg font-bold text-blue-950",children:a?"View Category":r?"Update Category":"Create Category"}),e.jsx(H,{className:"text-sm text-gray-500",children:r?"Edit the details and click update.":"Fill in the details to add a new category."})]}),e.jsxs("form",{onSubmit:b(P),className:"space-y-4 mt-2",children:[e.jsxs("div",{children:[e.jsxs(S,{htmlFor:"forum",children:["Select Forum ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"forum",...d("forum_id",{required:!0}),className:"mt-1 h-10 border border-gray-300 rounded px-3 text-sm w-full",defaultValue:"",disabled:E||a,children:E?e.jsx("option",{children:"Loading forums..."}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",disabled:!0,children:"-- Select a forum --"}),T.map(f=>e.jsx("option",{value:f.id,children:f.title},f.id))]})}),h.forum_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Forum selection is required."})]}),e.jsxs("div",{children:[e.jsxs(S,{htmlFor:"title",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Z,{disabled:a,id:"title",...d("title",{required:!0}),className:"mt-1 h-10 border border-gray-300 rounded px-3 text-sm"}),!a&&h.title&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Title is required."})]}),e.jsxs("div",{children:[e.jsxs(S,{htmlFor:"description",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description",disabled:a,...d("description",{required:!0}),className:"mt-1 min-h-[100px] border border-gray-300 rounded px-3 py-2 text-sm w-full resize-none focus:ring-2 focus:ring-blue-500"}),!a&&h.description&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Description is required."})]}),!a&&e.jsx(K,{className:"mt-4",children:e.jsx(q,{type:"submit",className:"w-full bg-blue-950 hover:bg-blue-900 text-white font-semibold text-sm h-11 rounded flex items-center justify-center",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"mr-2 h-4 w-4 animate-spin"}),r?"Updating...":"Submitting..."]}):r?"Update":"Submit"})})]})]})]})},de=({token:t,limit:s=100,offset:n=0})=>{const u=O(),l=se({queryKey:["categories",s,n],queryFn:()=>ne(t||"",s,n).then(o=>o.data||[]),enabled:!!t,staleTime:1e3*60*5}),c=te({mutationFn:o=>{if(!t)throw new Error("Token missing");return le(o,t)},onSuccess:()=>{u.invalidateQueries({queryKey:["categories"]})}});return{categories:l.data||[],isLoading:l.isLoading,isDeleting:c.isPending,deleteCategory:c.mutateAsync,refetchCategories:l.refetch}},xe=()=>{const t=_(),{categories:s,isLoading:n,deleteCategory:u,refetchCategories:l}=de({token:t,limit:100}),[c,o]=g.useState(s);g.useEffect(()=>{o(s)},[s]);const j=i=>{const r=i.toLowerCase(),a=s.filter(d=>{var b,m,x,h;return((m=(b=d==null?void 0:d.title)==null?void 0:b.toLowerCase())==null?void 0:m.includes(r))||((h=(x=d==null?void 0:d.description)==null?void 0:x.toLowerCase())==null?void 0:h.includes(r))});o(a)},p=async(i,r)=>{await u(i),N.success(`"${r}" has been removed.`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(G,{title:"All Categories",searchPlaceholder:"Search by Category",onSearch:j,createButton:e.jsx(D,{onCreateOrUpdate:l})}),e.jsx("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm table-auto",children:[e.jsx("thead",{className:"bg-blue-950 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3 w-1/4",children:"TITLE"}),e.jsx("th",{className:"text-left px-6 py-3 w-1/4",children:"FORUM"}),e.jsx("th",{className:"text-left px-6 py-3 w-auto",children:"DESCRIPTION"}),e.jsx("th",{className:"text-left px-4 py-3",children:"DATE"}),e.jsx("th",{className:"text-left px-6 py-3 whitespace-nowrap w-1/4",children:"ACTION"})]})}),e.jsx("tbody",{children:c.length>0?c.map((i,r)=>{var a;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-4 align-top",children:i.title}),e.jsx("td",{className:"px-6 py-4 align-top",children:i.forum_name}),e.jsxs("td",{className:"px-4 py-3 align-top max-w-[300px]",children:[e.jsx("div",{className:"line-clamp-2 text-sm max-w-full",children:(i.description??"").length>120?((a=i.description)==null?void 0:a.slice(0,120))+"...":i.description||"-"}),(i.description??"").length>120&&e.jsx(D,{category:i,viewOnly:!0,trigger:e.jsx("button",{className:"text-xs text-blue-600 hover:underline mt-1 inline-block",children:"Read more"})})]}),e.jsx("td",{className:"px-4 py-3 align-top",children:ie(i.updated_at||i.created_at)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(D,{category:i,onCreateOrUpdate:l,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-green-500 text-green-500 px-3 py-1 rounded hover:bg-green-50 text-sm",children:[e.jsx(W,{size:16})," Edit"]})}),e.jsx(J,{title:"Delete Category?",content:"This category will be permanently removed.",confirmLabel:"Remove",onConfirm:()=>p(i.id,i.title),onSuccess:l,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-red-500 text-red-500 px-3 py-1 rounded hover:bg-red-50 text-sm",children:[e.jsx(X,{size:16})," Delete"]})})]})})]},r)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center text-gray-500 px-6 py-6",children:n?"Loading...":"No categories found."})})})]})})]})};export{xe as default};
