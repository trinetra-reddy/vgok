import{c as S,j as e,r as j,t as T,f as v,a as E,u as q,h as $}from"./index-DGg-eoZa.js";import{j as A,C as F,u as I,D as L,a as O,b as U,c as K,d as P,e as V,F as z,g as k,P as M,h as w,T as Q}from"./useUserToken-Di5FAHIw.js";import{B,P as R,a as G,u as f}from"./button-EXXSqmvd.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],H=S("arrow-down",W);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],J=S("monitor",Y),X=({name:t,disabled:s=!1})=>{const{control:r,formState:{errors:n}}=A();return e.jsx(F,{name:t,control:r,rules:{required:"At least one tag is required"},render:({field:{value:u,onChange:i}})=>{var h,p;const c=Array.isArray(u)?u:[],[y,a]=j.useState(""),x=o=>{if((o.key==="Enter"||o.key===",")&&y.trim()){o.preventDefault();const d=y.trim();c.includes(d)||(i([...c,d]),a(""))}},m=o=>{const d=[...c];d.splice(o,1),i(d)};return e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tags ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:`flex flex-wrap items-center border rounded px-2 py-2 min-h-[42px] bg-white ${n[t]?"border-red-500":"border-gray-300"} ${s?"bg-gray-100 cursor-not-allowed":""}`,children:[c.map((o,d)=>e.jsxs("div",{className:"flex items-center bg-gray-200 text-sm rounded px-2 py-1 mr-2 mb-2",children:[e.jsx("span",{children:o}),!s&&e.jsx("button",{type:"button",className:"ml-2 text-gray-600 hover:text-red-600",onClick:()=>m(d),children:"×"})]},d)),!s&&e.jsx("input",{type:"text",value:y,onChange:o=>a(o.target.value),onKeyDown:x,className:"flex-grow border-none outline-none p-1 text-sm",placeholder:"Add a tag"})]}),n[t]&&!s&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:(p=(h=n[t])==null?void 0:h.message)==null?void 0:p.toString()})]})}})},Z=({isEdit:t=!1,type:s,categories:r=[],isCategoryLoading:n=!1})=>{var m,h;const{register:u,formState:{errors:i},setValue:c,watch:y}=A(),a=s==="view",x=y("category_id");return j.useEffect(()=>{if(!x&&r.length>0&&!r.find(o=>o.id===x)&&t){const o=r.find(d=>d.id===x);o&&c("category_id",o.id)}},[r,x,c,t]),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Image"}),e.jsx("img",{src:"https://via.placeholder.com/380x315",alt:"Preview",className:"rounded border border-gray-300 min-h-[85%]"}),!a&&e.jsx("button",{type:"button",className:"absolute bottom-2 right-2 bg-[#4269c2] text-white p-2 rounded-full shadow",children:"🖊️"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Select Category ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{...u("category_id",{required:!0}),className:`w-full border rounded px-3 py-2 ${i.category_id?"border-red-500":"border-gray-300"}`,disabled:a||n,children:[e.jsx("option",{value:"",children:"-- Select Category --"}),r.map(p=>e.jsxs("option",{value:p.id,children:[p.title," ",p.forum_name?`- ${p.forum_name}`:""]},p.id))]}),i.category_id&&!a&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:"Category is required"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...u("title",{required:"Title is required"}),disabled:a,className:`w-full border rounded px-3 py-2 ${i.title?"border-red-500":"border-gray-300"}`}),i.title&&!a&&typeof((m=i==null?void 0:i.title)==null?void 0:m.message)=="string"&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:(h=i==null?void 0:i.title)==null?void 0:h.message})]})]}),e.jsx(X,{name:"tags",disabled:a}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Video URL"}),e.jsx("input",{type:"text",...u("video_url"),disabled:a,className:"w-full border border-gray-300 rounded px-3 py-2"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{...u("description"),rows:6,disabled:a,className:"w-full border border-gray-300 rounded px-3 py-2"})]}),!a&&e.jsx("div",{className:"md:col-span-2",children:e.jsx("button",{type:"submit",className:"w-full bg-[#4269c2] hover:bg-[#2f55a3] text-white py-2 rounded font-semibold",children:t?"Update":"Submit"})})]})},_=({onCreateOrUpdate:t,formData:s,trigger:r,type:n,onCreate:u,onUpdate:i,categories:c,isCategoryLoading:y=!1})=>{const[a,x]=j.useState(!1),m=!!s,h=I({defaultValues:{title:(s==null?void 0:s.title)||"",content:(s==null?void 0:s.content)||"",description:(s==null?void 0:s.description)||"",status:(s==null?void 0:s.status)||"pending",tags:(s==null?void 0:s.tags)||"",video_url:(s==null?void 0:s.video_url)||"",category_id:(s==null?void 0:s.category_id)||""}}),{reset:p}=h;j.useEffect(()=>{a&&s?h.reset({title:s.title,content:s.content,description:s.description,status:s.status,tags:s.tags,video_url:s.video_url,category_id:s.category_id||""}):h.reset()},[a,s,h]);const o=async d=>{try{const g=c.find(b=>b.id===d.category_id);if(!g){T.error("Invalid category selection.");return}const l={...d,forum_id:g.forum_id,forum_name:g.forum_name,category_name:g.title};m&&(s!=null&&s.id)&&i?await i(s.id,l):u&&await u(l),t==null||t(),p(),x(!1)}catch(g){T.error("Something went wrong."),console.error(g)}};return e.jsxs(L,{open:a,onOpenChange:x,children:[e.jsx(O,{asChild:!0,children:r??e.jsxs(B,{variant:"outline",className:"flex items-center gap-2 border border-[#4269c2] text-[#4269c2] hover:bg-blue-950 hover:text-white min-h-[42px] cursor-pointer",children:[e.jsx(R,{size:16})," Create New"]})}),e.jsxs(U,{className:"sm:max-w-2xl w-full",onInteractOutside:d=>d.preventDefault(),onEscapeKeyDown:d=>d.preventDefault(),children:[e.jsxs(K,{children:[e.jsx(P,{className:"text-lg font-bold text-blue-950",children:n==="view"?"View Topic":m?"Update Topic":"Create Topic"}),n!=="view"&&e.jsx(V,{className:"text-sm text-gray-500",children:m?"Edit the details and click update.":"Fill in the details to add a new topic."})]}),e.jsx("div",{className:"max-h-[80vh] overflow-y-auto pr-2",children:e.jsx(z,{...h,children:e.jsx("form",{onSubmit:h.handleSubmit(o),children:e.jsx(Z,{isEdit:m,type:n,categories:c,isCategoryLoading:y})})})})]})]})},N="https://vgok.onrender.com/api",D=async(t,s)=>v(`${N}/posts/create`,"POST",s,t),ee=async(t,s,r)=>v(`${N}/posts/update/${t}`,"PUT",r,s),se=async(t,s)=>v(`${N}/posts/delete/${t}`,"DELETE",s),te=async(t,s)=>{let r=`${N}/posts/all`;return s&&(r+=`?status=${s}`),v(r,"GET",t)},de=(t,s=10,r=0)=>{const n=k();return G({queryKey:["topics",t,s,r],queryFn:()=>te(n||"",t),enabled:!!n})},re=()=>{const t=k(),s=E(),r=f({mutationFn:i=>D(i,t||""),onSuccess:()=>s.invalidateQueries({queryKey:["topics"]})}),n=f({mutationFn:({id:i,data:c})=>ee(i,c,t||""),onSuccess:()=>s.invalidateQueries({queryKey:["topics"]})}),u=f({mutationFn:i=>se(i,t||""),onSuccess:()=>s.invalidateQueries({queryKey:["topics"]})});return{createTopic:r.mutateAsync,updateTopic:n.mutateAsync,deleteTopic:u.mutateAsync,isCreating:r.isPending,isUpdating:n.isPending,isDeleting:u.isPending}},ce=({data:t,loading:s,onRefresh:r,page:n=1,pageSize:u=10,totalCount:i=0,onPageChange:c,showActions:y=!1,categories:a=[]})=>{var g;const{user:x}=q(),m=(x==null?void 0:x.role)||((g=x==null?void 0:x.user_metadata)==null?void 0:g.role),{createTopic:h,updateTopic:p,deleteTopic:o}=re(),d=Math.ceil(i/u);return e.jsxs("div",{className:"overflow-x-auto bg-white rounded-xl shadow",children:[e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-blue-950 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3",children:"TITLE"}),e.jsx("th",{className:"text-left px-6 py-3",children:"CATEGORY - FORUM"}),e.jsx("th",{className:"text-left px-6 py-3",children:"UP - DOWN VOTE"}),e.jsx("th",{className:"text-left px-6 py-3",children:"STATUS"}),e.jsx("th",{className:"text-left px-6 py-3 text-right",children:"ACTION"})]})}),e.jsx("tbody",{children:s?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-6 text-gray-500",children:"Loading topics..."})}):t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-6 text-gray-500",children:"No topics found."})}):t.map(l=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-4",children:l.title}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{children:l.category_name}),e.jsx("div",{children:e.jsxs("small",{children:[" ",l.forum_name," "]})})]}),e.jsxs("td",{className:"px-6 py-4 flex items-center gap-2",children:[e.jsxs("span",{className:"text-green-500 flex items-center gap-1",children:[e.jsx($,{size:12})," ",l.upvotes||0]}),e.jsxs("span",{className:"text-red-500 flex items-center gap-1",children:[e.jsx(H,{size:12})," ",l.downvotes||0]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${l.status==="approved"?"bg-green-100 text-green-600":l.status==="rejected"?"bg-red-100 text-red-600":"bg-orange-100 text-orange-600"}`,children:l.status||"Pending"})}),e.jsxs("td",{className:"px-6 py-4 flex flex-wrap gap-2",children:[e.jsx(_,{formData:l,categories:a,onCreateOrUpdate:r,type:"view",trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-blue-500 text-blue-500 px-3 py-1 rounded hover:bg-blue-50 text-sm",children:[e.jsx(J,{size:16})," Detail"]})}),y&&e.jsxs(e.Fragment,{children:[e.jsx(_,{formData:l,categories:a,onCreateOrUpdate:r,type:"edit",trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-green-500 text-green-500 px-3 py-1 rounded hover:bg-green-50 text-sm",children:[e.jsx(M,{size:16})," Edit"]}),onCreate:b=>h(b).then(r),onUpdate:(b,C)=>p({id:b,data:C}).then(r)}),(m==="admin"||m==="superadmin"||y)&&e.jsx(w,{title:"Delete Topic?",content:"This topic will be permanently removed.",confirmLabel:"Remove",onConfirm:()=>o(l.id),onSuccess:r,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-red-500 text-red-500 px-3 py-1 rounded hover:bg-red-50 text-sm",children:[e.jsx(Q,{size:16})," Delete"]})})]}),(m==="admin"||m==="superadmin")&&e.jsxs(e.Fragment,{children:[e.jsx(w,{title:"Approve Topic?",content:"Are you sure you want to approve this topic?",confirmLabel:"Approve",onConfirm:()=>p({id:l.id,data:{...l,status:"approved"}}),onSuccess:r,trigger:e.jsx("button",{className:"flex items-center gap-2 border border-green-600 text-green-600 px-3 py-1 rounded hover:bg-green-50 text-sm disabled:opacity-50",disabled:l.status==="approved",title:l.status==="approved"?"Already approved":"",children:"Approve"})}),e.jsx(w,{title:"Reject Topic?",content:"Are you sure you want to reject this topic?",confirmLabel:"Reject",onConfirm:()=>p({id:l.id,data:{...l,status:"rejected"}}),onSuccess:r,trigger:e.jsx("button",{className:"flex items-center gap-2 border border-red-600 text-red-600 px-3 py-1 rounded hover:bg-red-50 text-sm disabled:opacity-50",disabled:l.status==="rejected",title:l.status==="rejected"?"Already rejected":"",children:"Reject"})})]})]})]},l.id))})]}),d>1&&e.jsxs("div",{className:"flex justify-end items-center gap-2 p-4",children:[e.jsx("button",{className:"text-sm px-3 py-1 border rounded disabled:opacity-50",onClick:()=>c==null?void 0:c(n-1),disabled:n<=1,children:"Previous"}),e.jsxs("span",{className:"text-sm",children:["Page ",n," of ",d]}),e.jsx("button",{className:"text-sm px-3 py-1 border rounded disabled:opacity-50",onClick:()=>c==null?void 0:c(n+1),disabled:n>=d,children:"Next"})]})]})};export{_ as C,ce as T,re as a,de as u};
