import{f as j,a as N,t as g,r as x,u as v,j as e}from"./index-BPKX_cgv.js";import{a as S,B as f}from"./button-DZgg7u2Y.js";import{a as A,u as w}from"./useMutation-DH1_dSWY.js";const b="https://vgok.onrender.com/api",C=async r=>j(`${b}/admin/users`,"GET",r),L=async(r,n,t)=>j(`${b}/admin/users/${r}/role`,"PUT",t,{role:n}),R=r=>{const n=N(),{data:t,isLoading:m}=A({queryKey:["admin-users"],queryFn:()=>C(r||""),enabled:!!r}),l=w({mutationFn:({id:o,role:d,token:a})=>L(o,d,a),onMutate:async({id:o,role:d})=>{await n.cancelQueries({queryKey:["admin-users"]});const a=n.getQueryData(["admin-users"]);return n.setQueryData(["admin-users"],c=>({users:c.users.map(u=>u.id===o?{...u,role:d}:u)})),{previousData:a}},onError:(o,d,a)=>{g.error("Failed to update role"+o),a!=null&&a.previousData&&n.setQueryData(["admin-users"],a.previousData)},onSuccess:()=>{g.success("Role updated successfully")},onSettled:()=>{n.invalidateQueries({queryKey:["admin-users"]})}});return{users:(t==null?void 0:t.users)||[],isLoading:m,mutate:l.mutate}},E=()=>{const[r,n]=x.useState(""),[t,m]=x.useState("all"),{user:l}=v(),{users:o,isLoading:d,mutate:a}=R(l==null?void 0:l.token),c=x.useMemo(()=>{const s=r.toLowerCase();return o.filter(i=>{var p,y;return(t==="all"||i.role===t)&&(((p=i.email)==null?void 0:p.toLowerCase().includes(s))||((y=i.role)==null?void 0:y.toLowerCase().includes(s)))})},[o,t,r]),u=s=>{const i={admin:"bg-green-100 text-green-700",superadmin:"bg-purple-100 text-purple-700",user:"bg-gray-100 text-gray-700"}[s]||"bg-gray-100 text-gray-700";return e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${i}`,children:s})},h=(s,i)=>{!confirm(`Are you sure you want to set role as '${i}'?`)||!(l!=null&&l.token)||a({id:s,role:i,token:l.token})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(S,{title:"Manage Roles",searchPlaceholder:"Search by email or role",onSearch:s=>n(s),statusValue:t,onStatusChange:m,statusOptions:[{label:"All",value:"all"},{label:"Admin",value:"admin"},{label:"Super Admin",value:"superadmin"},{label:"User",value:"user"}]}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-xl shadow",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-blue-950 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3",children:"EMAIL"}),e.jsx("th",{className:"text-left px-6 py-3",children:"ROLE"}),e.jsx("th",{className:"text-left px-6 py-3",children:"ACTIONS"})]})}),e.jsx("tbody",{children:d?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center py-6 text-gray-500",children:"Loading users..."})}):c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center py-6 text-gray-500",children:"No users found."})}):c.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-4",children:s.email}),e.jsx("td",{className:"px-6 py-4",children:u(s.role)}),e.jsxs("td",{className:"px-6 py-4 flex gap-2 flex-wrap",children:[e.jsx(f,{disabled:s.role==="admin"||s.role==="superadmin",onClick:()=>h(s.id,"admin"),variant:"outline",className:"text-green-700 border-green-600 hover:bg-green-50",children:"Promote to Admin"}),e.jsx(f,{disabled:s.role==="user",onClick:()=>h(s.id,"user"),variant:"outline",className:"text-red-700 border-red-600 hover:bg-red-50",children:"Demote to User"})]})]},s.id))})]})})]})};export{E as default};
