import{j as e,u as z,r as x,g as A,t as v,s as P}from"./index-BFFADSzA.js";const u=({message:o})=>o?e.jsx("p",{className:"text-sm text-red-500 mt-1",children:o}):null,F=o=>o.charAt(0).toUpperCase()+o.slice(1),E=(o,l,p)=>{const b={},h=typeof p=="string"?[p]:Object.keys(l);for(const c of h){const t=o[c]??"",n=l[c];if(!n)continue;const s=F(c);if(n.required&&!t.trim()){b[c]=n.message||`${s} is required`;continue}if(n.pattern&&!n.pattern.test(t)){b[c]=n.patternMessage||`${s} format is invalid`;continue}n.min&&t.length<n.min&&(b[c]=`${s} must be at least ${n.min} characters`)}return b},O=o=>`w-full px-3 py-2 border rounded focus:outline-none ${o?"border-red-500 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`,D=()=>{const{setAuthenticatedUser:o,user:l}=z(),[p,b]=x.useState(null),[h,c]=x.useState(""),[t,n]=x.useState(l),[s,w]=x.useState({id:"",firstName:"",lastName:"",email:"",mobile:"",address:"",state:"",zipcode:"",city:"",country:"",avatar_url:"",bio:""}),[m,y]=x.useState({}),C={firstName:{required:!0},lastName:{required:!0},email:{required:!1,patternMessage:"Enter a valid email"},address:{required:!0},city:{required:!0},state:{required:!0},zipcode:{required:!0}};x.useEffect(()=>{l&&t&&w({id:l.id,firstName:t.firstName||"",lastName:t.lastName||"",email:t.email||"",mobile:t.mobile||"",address:t.address||"",state:t.state||"",zipcode:t.zipcode||"",city:t.city||"",country:t.country||"",avatar_url:t.avatar_url||"",bio:t.bio||""})},[t]),x.useEffect(()=>{S()},[]);const S=async()=>{if(l!=null&&l.token)try{const i=await A(l==null?void 0:l.token);n(i),c(i.avatar_url)}catch(i){i instanceof Error?v.error(i.message):v.error("Something went wrong.")}},U=i=>{var a;const r=(a=i.target.files)==null?void 0:a[0];r&&(b(r),c(URL.createObjectURL(r)))},$=async()=>{if(!p||!l)return;const i=p.name.split(".").pop(),a=`${`${l.id}.${i}`}`,{error:j}=await P.storage.from("user-profile").upload(a,p,{upsert:!0});if(j)return;const{data:f}=P.storage.from("user-profile").getPublicUrl(a);return f==null?void 0:f.publicUrl},d=i=>{const{name:r,value:a,files:j}=i.target,f={...s,[r]:a};w(N=>({...N,[r]:j?j[0]:a}));let g=E(f,C,r);g=g[r]?g:{[r]:""},y(N=>({...N,...g}))},q=async i=>{i.preventDefault();const r=E(s,C);if(Object.keys(r).length>0){y(r);return}if(y({}),Object.keys(r).length>0)y(r);else if(p){const a=await $();a&&(s.avatar_url=a),k(s)}else k(s)},k=async i=>{const a=await(await fetch("https://vgok.onrender.com/api/profile/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).json();a.data.id&&(o({...l,...a==null?void 0:a.data}),v.success("Profile updated successfully!"))};return e.jsx("div",{className:"flex flex-col w-full",children:e.jsxs("main",{className:"flex-1 bg-white rounded-xl shadow  ",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2 border-b border-gray-300 p-3",children:"Profile Setting"}),e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 p-5 pt-2",onSubmit:q,children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["First Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",className:`w-full border border-gray-300 rounded px-3 py-2 ${O(m.firstName)}`,name:"firstName",value:s.firstName,onChange:d}),e.jsx(u,{message:m.firstName})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Last Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",name:"lastName",value:s.lastName,onChange:d}),e.jsx(u,{message:m.lastName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"E-mail Address"}),e.jsx("input",{type:"email",disabled:!0,className:"w-full border border-gray-300 rounded px-3 py-2 bg-gray-100",name:"email",value:s.email,onChange:d}),e.jsx(u,{message:m.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Mobile Number"}),e.jsx("input",{type:"text",disabled:!0,className:"w-full border border-gray-300 rounded px-3 py-2 bg-gray-100",name:"mobile",value:s.mobile,onChange:d}),e.jsx(u,{message:m.mobile})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Address",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",name:"address",value:s.address,onChange:d}),e.jsx(u,{message:m.address})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["City",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",name:"city",value:s.city,onChange:d}),e.jsx(u,{message:m.city})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["State",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",name:"state",value:s.state,onChange:d}),e.jsx(u,{message:m.state})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Zip Code",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",className:"w-full border border-gray-300 rounded px-3 py-2",name:"zipcode",value:s.zipcode,onChange:d}),e.jsx(u,{message:m.zipcode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Country"}),e.jsx("input",{type:"text",disabled:!0,className:"w-full border border-gray-300 rounded px-3 py-2 bg-gray-100",name:"country",value:s.country,onChange:d})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Image"}),e.jsx("input",{type:"file",accept:"image/*",className:"w-full border border-gray-300 rounded px-3 py-2 bg-white text-sm cursor-pointer file:cursor-pointer file:mr-2 file:py-1 file:px-2 file:border-0 file:bg-[#4269c2] file:text-white hover:border-[#4269c2] hover:bg-blue-50 transition",name:"avatar_url",onChange:U}),h&&e.jsx("img",{src:h,alt:"Preview",className:"w-24 h-24 rounded-full mt-2"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"About Yourself"}),e.jsx("textarea",{rows:5,className:"w-full border border-gray-300 rounded px-3 py-2",name:"bio",value:s.bio,onChange:d})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx("button",{type:"submit",className:"w-full bg-[#4269c2] hover:bg-[#3256a3] text-white py-3 rounded font-semibold cursor-pointer",children:"Update Profile"})})]})]})})};export{D as default};
