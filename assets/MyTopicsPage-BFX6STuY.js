import{r as c,u as A,j as e,A as E,t as o,B as U,D as O,E as k}from"./index-BPKX_cgv.js";import{i as L}from"./DeleteAlert-CxMyO-el.js";import{C as h,A as D,M as z}from"./CommonDialog-B8uZeMNL.js";import{a as F}from"./button-DZgg7u2Y.js";import{u as M}from"./UseApi-BayzhJq7.js";import{P as R,T as q}from"./trash-2-DWMekC5r.js";const W=()=>{const{request:w,loading:v}=M(),[u,N]=c.useState([]),[m,i]=c.useState([]),[d,T]=c.useState("All"),{user:s}=A(),C=[{label:"All",value:""},{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"}];c.useEffect(()=>{l()},[]);const l=async()=>{try{const r=(await w({url:"/posts/all",method:"GET"})).data||[];N(r),i(r)}catch(t){console.error("Failed to load topics",t)}},S=t=>s!=null&&s.token?k(t,s==null?void 0:s.token):Promise.resolve(),p=async t=>{if(!(s!=null&&s.token))return Promise.resolve();const r={...t,tags:t.tags,content:t.content};try{await O(r,s.token),o.success("Topic created successfully!")}catch(n){n instanceof Error?o.error(n.message):o.error("Something went wrong.")}},x=async(t,r)=>{if(!(s!=null&&s.token))return Promise.resolve();const n={...r,tags:r.tags,content:r.content};try{await U(t,n,s==null?void 0:s.token),o.success("Topic updated successfully.")}catch(a){a instanceof Error?o.error(a.message):o.error("Something went wrong.")}},P=t=>{const r=t.toLowerCase(),n=u.filter(a=>{var j,y,f,b;return((y=(j=a==null?void 0:a.title)==null?void 0:j.toLowerCase())==null?void 0:y.includes(r))||((b=(f=a==null?void 0:a.content)==null?void 0:f.toLowerCase())==null?void 0:b.includes(r))});i(n)};c.useEffect(()=>{g()},[d]);const g=()=>{const t=u.filter(r=>{var n,a;return(a=(n=r==null?void 0:r.status)==null?void 0:n.toLowerCase())==null?void 0:a.includes(d)});i(t)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:e.jsx(F,{title:"All Topics",searchPlaceholder:"Search by topic",onSearch:P,statusValue:d,onStatusChange:T,onStatusClick:g,statusOptions:C,createButton:e.jsx(h,{onCreateOrUpdate:l,onCreate:async t=>s?await p(t):Promise.resolve(),onUpdate:x,type:"add"})})}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-xl shadow",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-blue-950 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3",children:"TITLE"}),e.jsx("th",{className:"text-left px-6 py-3",children:"FORUM"}),e.jsx("th",{className:"text-left px-6 py-3",children:"UP - DOWN VOTE"}),e.jsx("th",{className:"text-left px-6 py-3",children:"STATUS"}),e.jsx("th",{className:"text-left px-6 py-3",children:"ACTION"})]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-6 text-gray-500",children:v?"Loading topics...":"No topics found."})}):m.map(t=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-4",children:t.title}),e.jsx("td",{className:"px-6 py-4",children:t.content}),e.jsxs("td",{className:"px-6 py-4 flex items-center gap-2",children:[e.jsxs("span",{className:"text-green-500 flex items-center gap-1",children:[e.jsx(E,{size:12})," ",t.upvotes||0]}),e.jsxs("span",{className:"text-red-500 flex items-center gap-1",children:[e.jsx(D,{size:12})," ",t.downvotes||0]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.status==="approved"?"bg-green-100 text-green-600":t.status==="rejected"?"bg-red-100 text-red-600":"bg-orange-100 text-orange-600"}`,children:t.status||"Pending"})}),e.jsxs("td",{className:"px-6 py-4 flex gap-2",children:[e.jsx(h,{formData:t,onCreateOrUpdate:l,type:"view",trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-blue-500 text-blue-500 px-3 py-1 rounded hover:bg-blue-50 text-sm",children:[e.jsx(z,{size:16})," Detail"]}),onCreate:async r=>s?await p(r):Promise.resolve(),onUpdate:x}),e.jsx(h,{formData:t,onCreateOrUpdate:l,type:"edit",trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-green-500 text-green-500 px-3 py-1 rounded hover:bg-green-50 text-sm",children:[e.jsx(R,{size:16})," Edit"]}),onCreate:async r=>s?await p(r):Promise.resolve(),onUpdate:x}),e.jsx(L,{title:"Delete Forum?",content:"This forum will be permanently removed.",confirmLabel:"Remove",onConfirm:()=>S(t.id),onSuccess:()=>{l(),o.success(`"${t.title}" has been removed.`)},trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-red-500 text-red-500 px-3 py-1 rounded hover:bg-red-50 text-sm",children:[e.jsx(q,{size:16})," Delete"]})})]})]},t.id))})]})})]})};export{W as default};
