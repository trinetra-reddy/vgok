import{a as A,j as e,r as h,u as F,t as y,b as O,d as L,e as U,f as q}from"./index-DpHCmz4P.js";import{m as P,C as I,u as E,k as z,D as M,a as R,B as V,b as _,c as $,d as B,e as K,F as H,i as G,j as W}from"./DeleteAlert-BcIM0iS5.js";import{P as J,a as Q,T as X}from"./trash-2-_uKcppE-.js";import{u as Y}from"./UseApi-DBK6DfIy.js";import{M as Z}from"./monitor-Ddwkzlje.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],ee=A("arrow-down",D),se=({name:x})=>{const{control:t,formState:{errors:p}}=P();return e.jsx(I,{name:x,control:t,rules:{required:"At least one tag is required"},render:({field:{value:u,onChange:a}})=>{var i,b;const o=Array.isArray(u)?u:[],[d,g]=h.useState(""),r=c=>{if((c.key==="Enter"||c.key===",")&&d.trim()){c.preventDefault();const l=d.trim();o.includes(l)||(a([...o,l]),g(""))}},v=c=>{const l=[...o];l.splice(c,1),a(l)};return e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tags ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:`flex flex-wrap items-center border rounded px-2 py-2 min-h-[42px] 
        ${p[x]?"border-red-500":"border-gray-300"} focus-within:ring-2 focus-within:ring-blue-500`,children:[o.map((c,l)=>e.jsxs("div",{className:"flex items-center bg-gray-200 text-sm rounded px-2 py-1 mr-2 mb-2",children:[e.jsx("span",{children:c}),e.jsx("button",{type:"button",className:"ml-2 text-gray-600 hover:text-red-600",onClick:()=>v(l),children:"×"})]},l)),e.jsx("input",{type:"text",value:d,onChange:c=>g(c.target.value),onKeyDown:r,className:"flex-grow border-none outline-none p-1 text-sm",placeholder:"Add a tag"})]}),p[x]&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:(b=(i=p[x])==null?void 0:i.message)==null?void 0:b.toString()})]})}})},te=({isEdit:x=!1,type:t,forum:p=[]})=>{var g;const{register:u,formState:{errors:a}}=P(),[o,d]=h.useState(p||[]);return h.useEffect(()=>{d(p||[])},[p]),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 p-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Image"}),e.jsx("img",{src:"https://via.placeholder.com/380x315",alt:"Preview",className:"rounded border border-gray-300 min-h-[85%]"}),e.jsx("button",{type:"button",className:"absolute bottom-2 right-2 bg-[#4269c2] text-white p-2 rounded-full shadow",children:"🖊️"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Forum"}),e.jsxs("select",{...u("content"),className:`w-full border rounded px-3 py-2 ${a.content?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"Select One"}),o.map(r=>e.jsx("option",{value:r.title,children:r.title},r.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Title",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",...u("title",{required:"Title is required"}),className:`w-full border rounded px-3 py-2 ${a.title?"border-red-500":"border-gray-300"}`}),typeof((g=a.title)==null?void 0:g.message)=="string"&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:a.title.message})]})]}),e.jsx(se,{name:"tags"}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Video URL"}),e.jsx("input",{type:"text",...u("video_url"),className:"w-full border border-gray-300 rounded px-3 py-2"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{...u("description"),rows:6,className:"w-full border border-gray-300 rounded px-3 py-2"})]}),t!=="view"&&e.jsx("div",{className:"md:col-span-2",children:e.jsx("button",{type:"submit",className:"w-full bg-[#4269c2] hover:bg-[#2f55a3] text-white py-2 rounded font-semibold",children:x?"Update":"Submit"})})]})},f=({onCreateOrUpdate:x,formData:t,trigger:p,type:u,onCreate:a,onUpdate:o})=>{const[d,g]=h.useState(!1),[r,v]=h.useState([]),{user:i}=F(),b=!!t,{reset:c}=E(),l=E({defaultValues:{title:(t==null?void 0:t.title)||"",content:(t==null?void 0:t.content)||"",description:(t==null?void 0:t.description)||"",status:(t==null?void 0:t.status)||"pending",tags:(t==null?void 0:t.tags)||""}});h.useEffect(()=>{d&&t?l.reset({title:t.title,content:t.content,description:t.description,status:t.status,tags:t.tags,video_url:t.video_url}):l.reset()},[d,t,l,r]),h.useEffect(()=>{i&&w()},[i]);const w=async()=>{if(i!=null&&i.token)try{const s=await z(i.token);v(s.data||[])}catch(s){console.error("Failed to fetch forums:",s)}},N=async s=>{console.log("onSubmit");try{b&&(t!=null&&t.id)&&o?await o(t.id,s):s&&a&&await a(s),x==null||x(),c(),g(!1)}catch(n){y.error("Something went wrong."),console.error(n)}};return e.jsxs(M,{open:d,onOpenChange:g,children:[e.jsx(R,{asChild:!0,children:p??e.jsxs(V,{variant:"outline",className:"flex items-center gap-2 border border-[#4269c2] text-[#4269c2] hover:bg-blue-950 hover:text-white min-h-[42px] cursor-pointer",children:[e.jsx(J,{size:16})," Create New"]})}),e.jsxs(_,{className:"sm:max-w-md",onInteractOutside:s=>s.preventDefault(),onEscapeKeyDown:s=>s.preventDefault(),children:[u!=="view"&&e.jsxs($,{children:[e.jsx(B,{className:"text-lg font-bold text-blue-950",children:b?"Update Topic":"Create Topic"}),e.jsx(K,{className:"text-sm text-gray-500",children:b?"Edit the details and click update.":"Fill in the details to add a new topic."})]}),e.jsx("div",{className:"max-h-[80vh] overflow-y-auto pr-2",children:e.jsx(H,{...l,children:e.jsx("form",{onSubmit:l.handleSubmit(N),children:e.jsx(te,{isEdit:b,type:u,forum:r})})})})]})]})},ae=()=>{const{request:x,loading:t}=Y(),[p,u]=h.useState([]),[a,o]=h.useState([]),[d,g]=h.useState("All"),{user:r}=F(),v=[{label:"All",value:""},{label:"Pending",value:"pending"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"}];h.useEffect(()=>{i()},[]);const i=async()=>{try{const n=(await x({url:"/posts/all",method:"GET"})).data||[];u(n),o(n)}catch(s){console.error("Failed to load topics",s)}},b=s=>r!=null&&r.token?q(s,r==null?void 0:r.token):Promise.resolve(),c=async s=>{if(!(r!=null&&r.token))return Promise.resolve();const n={...s,tags:s.tags,content:s.content};try{await U(n,r.token),y.success("Topic created successfully!")}catch(j){j instanceof Error?y.error(j.message):y.error("Something went wrong.")}},l=async(s,n)=>{if(!(r!=null&&r.token))return Promise.resolve();const j={...n,tags:n.tags,content:n.content};try{await L(s,j,r==null?void 0:r.token),y.success("Topic updated successfully.")}catch(m){m instanceof Error?y.error(m.message):y.error("Something went wrong.")}},w=s=>{const n=s.toLowerCase(),j=p.filter(m=>{var T,S,k,C;return((S=(T=m==null?void 0:m.title)==null?void 0:T.toLowerCase())==null?void 0:S.includes(n))||((C=(k=m==null?void 0:m.content)==null?void 0:k.toLowerCase())==null?void 0:C.includes(n))});o(j)};h.useEffect(()=>{N()},[d]);const N=()=>{const s=p.filter(n=>{var j,m;return(m=(j=n==null?void 0:n.status)==null?void 0:j.toLowerCase())==null?void 0:m.includes(d)});o(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:e.jsx(G,{title:"All Topics",searchPlaceholder:"Search by topic",onSearch:w,statusValue:d,onStatusChange:g,onStatusClick:N,statusOptions:v,createButton:e.jsx(f,{onCreateOrUpdate:i,onCreate:async s=>r?await c(s):Promise.resolve(),onUpdate:l,type:"add"})})}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-xl shadow",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-blue-950 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3",children:"TITLE"}),e.jsx("th",{className:"text-left px-6 py-3",children:"FORUM"}),e.jsx("th",{className:"text-left px-6 py-3",children:"UP - DOWN VOTE"}),e.jsx("th",{className:"text-left px-6 py-3",children:"STATUS"}),e.jsx("th",{className:"text-left px-6 py-3",children:"ACTION"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-6 text-gray-500",children:t?"Loading topics...":"No topics found."})}):a.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-6 py-4",children:s.title}),e.jsx("td",{className:"px-6 py-4",children:s.content}),e.jsxs("td",{className:"px-6 py-4 flex items-center gap-2",children:[e.jsxs("span",{className:"text-green-500 flex items-center gap-1",children:[e.jsx(O,{size:12})," ",s.upvotes||0]}),e.jsxs("span",{className:"text-red-500 flex items-center gap-1",children:[e.jsx(ee,{size:12})," ",s.downvotes||0]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="approved"?"bg-green-100 text-green-600":s.status==="rejected"?"bg-red-100 text-red-600":"bg-orange-100 text-orange-600"}`,children:s.status||"Pending"})}),e.jsxs("td",{className:"px-6 py-4 flex gap-2",children:[e.jsx(f,{formData:s,onCreateOrUpdate:i,type:"view",trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-blue-500 text-blue-500 px-3 py-1 rounded hover:bg-blue-50 text-sm",children:[e.jsx(Z,{size:16})," Detail"]}),onCreate:async n=>r?await c(n):Promise.resolve(),onUpdate:l}),e.jsx(f,{formData:s,onCreateOrUpdate:i,type:"edit",trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-green-500 text-green-500 px-3 py-1 rounded hover:bg-green-50 text-sm",children:[e.jsx(Q,{size:16})," Edit"]}),onCreate:async n=>r?await c(n):Promise.resolve(),onUpdate:l}),e.jsx(W,{title:"Delete Forum?",content:"This forum will be permanently removed.",confirmLabel:"Remove",onConfirm:()=>b(s.id),onSuccess:()=>{i(),y.success(`"${s.title}" has been removed.`)},trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-red-500 text-red-500 px-3 py-1 rounded hover:bg-red-50 text-sm",children:[e.jsx(X,{size:16})," Delete"]})})]})]},s.id))})]})})]})};export{ae as default};
