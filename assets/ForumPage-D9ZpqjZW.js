import{r as g,u as S,a as F,j as e,t as f}from"./index-CyUtciDf.js";import{u as v,B as N,P as C,a as E,b as L}from"./button-DbKxpifn.js";import{u as T,D as q,a as P,b as k,c as A,d as I,e as M,f as O,g as Q,P as z,h as R,T as B}from"./useUserToken-Bn7PhnP_.js";import{L as w,I as K,a as V,u as H,c as U,d as _,g as $,f as G}from"./index-BGn02vR2.js";const y=({onCreateOrUpdate:a,forum:t,trigger:d,viewOnly:o=!1})=>{const r=!!t,i=o,[n,p]=g.useState(!1),{user:c}=S(),s=F(),{register:l,handleSubmit:j,reset:m,setValue:x,formState:{errors:h}}=T();g.useEffect(()=>{n&&t?(x("title",t.title),x("description",t.description)):m()},[n,t,m,x]);const b=v({mutationFn:async u=>{if(!(c!=null&&c.token))throw new Error("Missing token");return r&&(t!=null&&t.id)?H(t.id,u,c.token):U(u,c.token)},onSuccess:()=>{f.success(`Forum ${r?"updated":"created"} successfully.`),s.invalidateQueries({queryKey:["forums"]}),a==null||a(),p(!1)},onError:u=>{console.error(u),f.error("Something went wrong.")}}),D=u=>{b.mutate(u)};return e.jsxs(q,{open:n,onOpenChange:p,children:[e.jsx(P,{asChild:!0,children:d??e.jsxs(N,{variant:"outline",className:"flex items-center gap-2 border border-[#4269c2] text-[#4269c2] hover:bg-blue-950 hover:text-white min-h-[42px] cursor-pointer",children:[e.jsx(C,{size:16})," Create Forum"]})}),e.jsxs(k,{className:"sm:max-w-2xl w-full",children:[e.jsxs(A,{children:[e.jsx(I,{className:"text-lg font-bold text-blue-950",children:i?"View Forum":r?"Update Forum":"Create Forum"}),!i&&e.jsx(M,{className:"text-sm text-gray-500",children:r?"Edit the details and click update.":"Fill in the details to add a new forum."})]}),e.jsxs("form",{onSubmit:j(D),className:"space-y-4 mt-2",autoComplete:"off",children:[e.jsxs("div",{children:[e.jsxs(w,{htmlFor:"title",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(K,{id:"title",...l("title",{required:!0}),disabled:i,className:"mt-1 h-10 border border-gray-300 rounded px-3 text-sm bg-white"}),!i&&h.title&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Title is required."})]}),e.jsxs("div",{children:[e.jsxs(w,{htmlFor:"description",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description",...l("description",{required:!0}),disabled:i,className:"mt-1 min-h-[120px] border border-gray-300 rounded px-3 py-2 text-sm w-full resize-none focus:ring-2 focus:ring-blue-500 bg-white"}),!i&&h.description&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Description is required."})]}),!i&&e.jsx(O,{className:"mt-4",children:e.jsx(N,{type:"submit",className:"w-full bg-blue-950 hover:bg-blue-900 text-white font-semibold text-sm h-11 rounded flex items-center justify-center",disabled:b.isPending,children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),r?"Updating...":"Submitting..."]}):r?"Update":"Submit"})})]})]})]})},J=({token:a,limit:t=10,offset:d=0})=>{const o=F(),r=E({queryKey:["forums",t,d],queryFn:()=>$(a||"",t,d).then(n=>n.data||[]),enabled:!!a}),i=v({mutationFn:n=>{if(!a)throw new Error("Missing token");return _(n,a)},onSuccess:()=>{o.invalidateQueries({queryKey:["forums"]})}});return{forums:r.data||[],isLoading:r.isLoading,error:r.error,refetchForums:r.refetch,deleteForum:i.mutateAsync,isDeleting:i.isPending}},ee=()=>{const a=Q(),{forums:t,isLoading:d,refetchForums:o,deleteForum:r}=J({token:a,limit:100}),[i,n]=g.useState([]);g.useEffect(()=>{n(t)},[t]);const p=s=>{const l=s.toLowerCase(),j=t.filter(m=>{var x,h;return((x=m.title)==null?void 0:x.toLowerCase().includes(l))||((h=m.description)==null?void 0:h.toLowerCase().includes(l))});n(j)},c=async(s,l)=>{await r(s),f.success(`"${l}" has been removed.`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(L,{title:"All Forums",searchPlaceholder:"Search by forum",onSearch:p,createButton:e.jsx(y,{onCreateOrUpdate:o})}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-xl shadow",children:e.jsxs("table",{className:"w-full text-sm table-auto min-w-[800px]",children:[e.jsx("thead",{className:"bg-blue-950 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"TITLE"}),e.jsx("th",{className:"text-left px-4 py-3",children:"DESCRIPTION"}),e.jsx("th",{className:"text-left px-4 py-3",children:"DATE"}),e.jsx("th",{className:"text-left px-4 py-3",children:"ACTION"})]})}),e.jsx("tbody",{children:i.length>0?i.map(s=>{var l;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 align-top",children:s.title}),e.jsxs("td",{className:"px-4 py-3 align-top max-w-[300px]",children:[e.jsx("div",{className:"line-clamp-2 text-sm max-w-full",children:(s.description??"").length>120?((l=s.description)==null?void 0:l.slice(0,120))+"...":s.description||"-"}),(s.description??"").length>120&&e.jsx(y,{forum:s,viewOnly:!0,trigger:e.jsx("button",{className:"text-xs text-blue-600 hover:underline mt-1 inline-block",children:"Read more"})})]}),e.jsx("td",{className:"px-4 py-3 align-top",children:G(s.updated_at||s.created_at)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(y,{forum:s,onCreateOrUpdate:o,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-green-500 text-green-500 px-3 py-1 rounded hover:bg-green-50 text-sm",children:[e.jsx(z,{size:16})," Edit"]})}),e.jsx(R,{title:"Delete Forum?",content:"This forum will be permanently removed.",confirmLabel:"Remove",onConfirm:()=>c(s.id,s.title),onSuccess:o,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-red-500 text-red-500 px-3 py-1 rounded hover:bg-red-50 text-sm",children:[e.jsx(B,{size:16})," Delete"]})})]})})]},s.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center text-gray-500 px-6 py-6",children:d?"Loading forums...":"No forums found."})})})]})})]})};export{ee as default};
