import{r as p,u as v,a as D,j as e,t as N}from"./index-BPKX_cgv.js";import{B as w,P as S,a as C}from"./button-DZgg7u2Y.js";import{u as E,D as T,a as L,b as P,c as k,d as q,e as I,f as A,g as O,h as z,i as R}from"./DeleteAlert-CxMyO-el.js";import{L as y,I as B,a as M,u as V,f as H}from"./index-B_O3rHGe.js";import{u as Q}from"./useMutation-DH1_dSWY.js";import{u as U}from"./useUserToken-GJF2sMhJ.js";import{P as _,T as $}from"./trash-2-DWMekC5r.js";const f=({onCreateOrUpdate:d,forum:t,trigger:g,viewOnly:x=!1})=>{const a=!!t,r=x,[n,h]=p.useState(!1),{user:l}=v(),s=D(),{register:i,handleSubmit:j,reset:m,setValue:o,formState:{errors:u}}=E();p.useEffect(()=>{n&&t?(o("title",t.title),o("description",t.description)):m()},[n,t,m,o]);const b=Q({mutationFn:async c=>{if(!(l!=null&&l.token))throw new Error("Missing token");return a&&(t!=null&&t.id)?O(t.id,c,l.token):z(c,l.token)},onSuccess:()=>{N.success(`Forum ${a?"updated":"created"} successfully.`),s.invalidateQueries({queryKey:["forums"]}),d==null||d(),h(!1)},onError:c=>{console.error(c),N.error("Something went wrong.")}}),F=c=>{b.mutate(c)};return e.jsxs(T,{open:n,onOpenChange:h,children:[e.jsx(L,{asChild:!0,children:g??e.jsxs(w,{variant:"outline",className:"flex items-center gap-2 border border-[#4269c2] text-[#4269c2] hover:bg-blue-950 hover:text-white min-h-[42px] cursor-pointer",children:[e.jsx(S,{size:16})," Create Forum"]})}),e.jsxs(P,{className:"sm:max-w-2xl w-full",children:[e.jsxs(k,{children:[e.jsx(q,{className:"text-lg font-bold text-blue-950",children:r?"View Forum":a?"Update Forum":"Create Forum"}),!r&&e.jsx(I,{className:"text-sm text-gray-500",children:a?"Edit the details and click update.":"Fill in the details to add a new forum."})]}),e.jsxs("form",{onSubmit:j(F),className:"space-y-4 mt-2",autoComplete:"off",children:[e.jsxs("div",{children:[e.jsxs(y,{htmlFor:"title",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(B,{id:"title",...i("title",{required:!0}),disabled:r,className:"mt-1 h-10 border border-gray-300 rounded px-3 text-sm bg-white"}),!r&&u.title&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Title is required."})]}),e.jsxs("div",{children:[e.jsxs(y,{htmlFor:"description",children:["Description ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"description",...i("description",{required:!0}),disabled:r,className:"mt-1 min-h-[120px] border border-gray-300 rounded px-3 py-2 text-sm w-full resize-none focus:ring-2 focus:ring-blue-500 bg-white"}),!r&&u.description&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:"Description is required."})]}),!r&&e.jsx(A,{className:"mt-4",children:e.jsx(w,{type:"submit",className:"w-full bg-blue-950 hover:bg-blue-900 text-white font-semibold text-sm h-11 rounded flex items-center justify-center",disabled:b.isPending,children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}),a?"Updating...":"Submitting..."]}):a?"Update":"Submit"})})]})]})]})},ee=()=>{const d=U(),{forums:t,isLoading:g,refetchForums:x,deleteForum:a}=V({token:d,limit:100}),[r,n]=p.useState([]);p.useEffect(()=>{n(t)},[t]);const h=s=>{const i=s.toLowerCase(),j=t.filter(m=>{var o,u;return((o=m.title)==null?void 0:o.toLowerCase().includes(i))||((u=m.description)==null?void 0:u.toLowerCase().includes(i))});n(j)},l=async(s,i)=>{await a(s),N.success(`"${i}" has been removed.`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(C,{title:"All Forums",searchPlaceholder:"Search by forum",onSearch:h,createButton:e.jsx(f,{onCreateOrUpdate:x})}),e.jsx("div",{className:"overflow-x-auto bg-white rounded-xl shadow",children:e.jsxs("table",{className:"w-full text-sm table-auto min-w-[800px]",children:[e.jsx("thead",{className:"bg-blue-950 text-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3",children:"TITLE"}),e.jsx("th",{className:"text-left px-4 py-3",children:"DESCRIPTION"}),e.jsx("th",{className:"text-left px-4 py-3",children:"DATE"}),e.jsx("th",{className:"text-left px-4 py-3",children:"ACTION"})]})}),e.jsx("tbody",{children:r.length>0?r.map(s=>{var i;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-3 align-top",children:s.title}),e.jsxs("td",{className:"px-4 py-3 align-top max-w-[300px]",children:[e.jsx("div",{className:"line-clamp-2 text-sm max-w-full",children:(s.description??"").length>120?((i=s.description)==null?void 0:i.slice(0,120))+"...":s.description||"-"}),(s.description??"").length>120&&e.jsx(f,{forum:s,viewOnly:!0,trigger:e.jsx("button",{className:"text-xs text-blue-600 hover:underline mt-1 inline-block",children:"Read more"})})]}),e.jsx("td",{className:"px-4 py-3 align-top",children:H(s.updated_at||s.created_at)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(f,{forum:s,onCreateOrUpdate:x,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-green-500 text-green-500 px-3 py-1 rounded hover:bg-green-50 text-sm",children:[e.jsx(_,{size:16})," Edit"]})}),e.jsx(R,{title:"Delete Forum?",content:"This forum will be permanently removed.",confirmLabel:"Remove",onConfirm:()=>l(s.id,s.title),onSuccess:x,trigger:e.jsxs("button",{className:"flex items-center gap-2 border border-red-500 text-red-500 px-3 py-1 rounded hover:bg-red-50 text-sm",children:[e.jsx($,{size:16})," Delete"]})})]})})]},s.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center text-gray-500 px-6 py-6",children:g?"Loading forums...":"No forums found."})})})]})})]})};export{ee as default};
